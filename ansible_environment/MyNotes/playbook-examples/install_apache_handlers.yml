---
- name: Install Apache
  hosts: servers
  remote_user: root
  gather_facts: false

  tasks:
  - name: Ensure Apache is installed when OS distribution is Ubuntu
    apt:
      name: apache2
      state: present

  - name: Write the apache config file
    template: 
      src: /srv/httpd.j2
      dest: /etc/httpd.conf
    notify:
    - restart apache

  - name: Start the apache service with enabling the service to start on boot.
    service:
      name: apache2
      state: started
      enabled: yes

  handlers: 
    - name: restart apache
      service:
        name: apache2
        state: restarted